webpackJsonp([24],{"/nrx":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("fe64"),n=a("doty"),o=a("m4J9"),s=a("KvKp"),r={data:function(){var t=this;return{quarterTitle:{name:"姓名",state:"部门"},deptId:1001,list:[],modifyList:[{name:""}],noModify:!0,page:{size:10,current:1},showModifyPanel:!1,operationObj:{},columnTitle:[{title:"序号",type:"index",width:50},{title:"姓名",row:"name",width:120},{title:"部门",format:function(e){return t.$options.filters.getValueById(+e.deptId,t.department,"id","name")},width:140},{title:"职位",row:"workDuty"},{title:"违规次数",format:function(e){return t.$options.filters.getAdminTime(e.score.data[2][10004])},sort:function(t){console.log(t)},width:120},{title:"分数",format:function(e){return t.$options.filters.getAdminScore(e.score.data[2][10004],t.selectObj)},sort:function(t){console.log(t)},width:120},{title:"操作",type:"operation",callback:this.operationObj,width:100}],selectObj:{}}},components:{AttTabSearch:i.a,Crumbs:n.a,AttendanceTable:o.a},beforeCreate:function(){var t=this,e=this.$store.state.common.user.role;1===e||2===e?this.operationObj={"详情":function(e){t.showModifyPanel=!0,t.modifyList=[e]}}:4===e&&(this.noModify=!1,this.operationObj={"修改":function(e){var a=s.a.clone(e);t.showModifyPanel=!0,t.modifyList=[a]}}),this.$http({url:"/score/rules"}).then(function(e){var a=e[2];a&&a.class.forEach(function(e){10004===e.id&&(t.selectObj=e)})})},computed:{itemList:function(){var t=[];return this.modifyList.length&&this.modifyList[0].score&&(t=this.modifyList[0].score.data[2][10004]),t},data:function(){var t=(this.page.current-1)*this.page.size,e=this.page.current*this.page.size;return this.list.slice(t,e)},department:function(){return this.$store.state.basic.department},quarterId:function(){return this.$store.state.common.quarterId}},mounted:function(){this.noModify=4!==this.$store.state.common.user.role,1!==this.$store.state.common.user.role&&2!==this.$store.state.common.user.role||this.$delete(this.columnTitle,this.columnTitle.length-1)},methods:{getData:function(){var t=this,e={quarterId:this.quarterId,deptId:this.deptId};this.$http.post("/attendance/query",e).then(function(e){t.list=e,t.page.total=e.length})},currentChange:function(t){this.page.current=t},modifyAttendance:function(){var t=this,e={quarterId:this.quarterId,update:this.modifyList},a=!0;this.modifyList[0].score.data[2][10004].forEach(function(e){e.evaluateId&&e.evaluateScore&&e.number||(t.$message({message:"请补全信息",type:"warning"}),a=!1)}),a&&this.$http.post("/attendance/update",e).then(function(e){var a={message:"修改成功",type:"success"};if("number"==typeof e){var i=t.modifyList[0];t.list.forEach(function(t,e){t.uid===i.uid&&(t.score.data[2]=i.score.data[2])})}else a={message:"修改失败",type:"error"};t.$message(a),t.showModifyPanel=!1})},sizeChange:function(t){this.page.size=t},addItem:function(){this.modifyList[0].score.data[2][10004].push({evaluateId:"",evaluateScore:"",number:0})},onSearch:function(t){var e=this,a={quarterId:this.quarterId,deptId:t.dept.id};this.$http.post("/attendance/query",a).then(function(a){var i=[];a.forEach(function(e){e.name.indexOf(t.name)>-1&&i.push(e)}),e.list=i,e.page.total=i.length})}}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"attendance-wrap attendance-tab-title-wrap"},[a("crumbs",{on:{callback:t.getData}}),t._v(" "),a("div",{staticClass:"attendance-search-table prl"},[a("att-tab-search",{attrs:{deptId:t.deptId,quarterTitle:t.quarterTitle},on:{search:t.onSearch}}),t._v(" "),a("div",{staticClass:"attendance-table"},[a("attendance-table",{attrs:{columnTitle:t.columnTitle,data:t.data,page:t.page},on:{sizeChange:t.sizeChange,currentChange:t.currentChange}})],1)],1),t._v(" "),a("div",{staticClass:"attendance-dialog"},[a("el-dialog",{attrs:{title:"修改行政记录",visible:t.showModifyPanel,width:"70%"},on:{"update:visible":function(e){t.showModifyPanel=e}}},[a("div",[a("p",[t._v(t._s(t.modifyList[0].name)+" - "+t._s(t._f("getValueById")(+t.modifyList[0].deptId,t.department,"id","name")))]),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.itemList}},[a("el-table-column",{attrs:{prop:"date",label:"内容"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{placeholder:"请选择",disabled:t.noModify},model:{value:t.modifyList[0].score.data[2][10004][e.$index].evaluateId,callback:function(a){t.$set(t.modifyList[0].score.data[2][10004][e.$index],"evaluateId",a)},expression:"modifyList[0].score.data['2']['10004'][scope.$index]['evaluateId']"}},t._l(t.selectObj.options,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"违规次数"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input-number",{attrs:{disabled:t.noModify},model:{value:t.modifyList[0].score.data[2][10004][e.$index].number,callback:function(a){t.$set(t.modifyList[0].score.data[2][10004][e.$index],"number",a)},expression:"modifyList[0].score.data['2']['10004'][scope.$index]['number']"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"分数"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input-number",{attrs:{disabled:t.noModify},model:{value:t.modifyList[0].score.data[2][10004][e.$index].evaluateScore,callback:function(a){t.$set(t.modifyList[0].score.data[2][10004][e.$index],"evaluateScore",a)},expression:"modifyList[0].score.data['2']['10004'][scope.$index]['evaluateScore']"}})]}}])})],1),t._v(" "),t.noModify?t._e():a("div",{staticClass:"add main-color",on:{click:t.addItem}},[t._v("+ 添加")])],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[t.noModify?[a("el-button",{attrs:{size:"medium"},on:{click:function(e){t.showModifyPanel=!1}}},[t._v("关 闭\n          ")])]:[a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.modifyAttendance}},[t._v("保存\n          ")]),t._v(" "),a("el-button",{attrs:{size:"medium"},on:{click:function(e){t.showModifyPanel=!1}}},[t._v("取 消\n          ")])]],2)])],1)],1)},staticRenderFns:[]};var c=a("Z0/y")(r,d,!1,function(t){a("lsJB")},"data-v-9d18910c",null);e.default=c.exports},lsJB:function(t,e){}});
//# sourceMappingURL=24.7e577d84162d2cf7819d.js.map