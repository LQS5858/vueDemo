webpackJsonp([30],{Il1p:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("fe64"),a=n("doty"),r=n("m4J9"),i=n("KvKp"),s={data:function(){var t=this;return{quarterTitle:{name:"姓名",state:"部门"},deptId:1001,list:[],modifyList:[],noModify:!0,operationObj:{},page:{size:10,current:1},showModifyPanel:!1,columnTitle:[{title:"序号",type:"index",width:50},{title:"姓名",row:"name",width:120},{title:"部门",format:function(e){return t.$options.filters.getValueById(+e.deptId,t.department,"id","name")}},{title:"职位",row:"workDuty"},{title:"迟到次数",format:function(t){return t.score.data[2][1e4].number},sort:function(t){console.log(t)},width:100},{title:"请假次数",format:function(t){return t.score.data[2][10001].number},sort:function(t){console.log(t)},width:100},{title:"早退次数",format:function(t){return t.score.data[2][10002].number},sort:function(t){console.log(t)},width:100},{title:"旷工次数",format:function(t){return t.score.data[2][10003].number},sort:function(t){console.log(t)},width:100},{title:"扣分",format:function(e){return t.$options.filters.getAttendanceScore(e.score.data[2],t.ruleList)},sort:function(t){console.log(t)},width:100},{title:"操作",type:"operation",callback:this.operationObj,width:100}],ruleList:{}}},components:{AttTabSearch:o.a,Crumbs:a.a,AttendanceTable:r.a},computed:{data:function(){var t=(this.page.current-1)*this.page.size,e=this.page.current*this.page.size;return this.list.slice(t,e)},department:function(){return this.$store.state.basic.department},quarterId:function(){return this.$store.state.common.quarterId}},beforeCreate:function(){var t=this,e=this.$store.state.common.user.role;1===e||2===e?this.operationObj={"详情":function(e){t.showModifyPanel=!0,t.modifyList=[e]}}:4===e&&(this.noModify=!1,this.operationObj={"修改":function(e){var n=i.a.clone(e);t.showModifyPanel=!0,t.modifyList=[n]}}),this.$http({url:"score/rules"}).then(function(e){t.ruleList=e})},mounted:function(){this.noModify=4!==this.$store.state.common.user.role,1!==this.$store.state.common.user.role&&2!==this.$store.state.common.user.role||this.$delete(this.columnTitle,this.columnTitle.length-1)},methods:{getData:function(){var t=this,e={quarterId:this.quarterId,deptId:this.deptId};this.$http.post("/attendance/query",e).then(function(e){t.list=e,t.page.total=e.length})},currentChange:function(t){this.page.current=t},sizeChange:function(t){this.page.size=t},modifyAttendance:function(){var t=this,e={quarterId:this.quarterId,update:this.modifyList};this.$http.post("/attendance/update",e).then(function(e){var n={message:"修改成功",type:"success"};if("number"==typeof e){var o=t.modifyList[0];t.list.forEach(function(t,e){t.uid===o.uid&&(t.score.data[2]=o.score.data[2])})}else n={message:"修改失败",type:"error"};t.$message(n),t.showModifyPanel=!1})},onSearch:function(t){var e=this,n={quarterId:this.quarterId,deptId:t.dept.id};this.$http.post("/attendance/query",n).then(function(n){var o=[];n.forEach(function(e){e.name.indexOf(t.name)>-1&&o.push(e)}),e.list=o,e.page.total=o.length})}}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"attendance-wrap"},[n("crumbs",{on:{callback:t.getData}}),t._v(" "),n("div",{staticClass:"attendance-search-table prl"},[n("att-tab-search",{attrs:{deptId:t.deptId,quarterTitle:t.quarterTitle},on:{search:t.onSearch}}),t._v(" "),n("div",{staticClass:"attendance-table"},[n("attendance-table",{attrs:{columnTitle:t.columnTitle,data:t.data,page:t.page},on:{sizeChange:t.sizeChange,currentChange:t.currentChange}})],1)],1),t._v(" "),n("el-dialog",{attrs:{title:"修改考勤",visible:t.showModifyPanel,width:"70%"},on:{"update:visible":function(e){t.showModifyPanel=e}}},[n("div",[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.modifyList}},[n("el-table-column",{attrs:{label:"姓名",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.name)+" - "+t._s(t._f("getValueById")(+e.row.deptId,t.department,"id","name"))+"\n          ")]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"name",label:"迟到次数",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-input-number",{attrs:{disabled:t.noModify},model:{value:e.row.score.data[2][1e4].number,callback:function(n){t.$set(e.row.score.data[2][1e4],"number",n)},expression:"scope.row.score.data['2']['10000']['number']"}})]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"name",label:"请假次数",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-input-number",{attrs:{disabled:t.noModify},model:{value:e.row.score.data[2][10001].number,callback:function(n){t.$set(e.row.score.data[2][10001],"number",n)},expression:"scope.row.score.data['2']['10001']['number']"}})]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"name",label:"早退次数",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-input-number",{attrs:{disabled:t.noModify},model:{value:e.row.score.data[2][10002].number,callback:function(n){t.$set(e.row.score.data[2][10002],"number",n)},expression:"scope.row.score.data['2']['10002']['number']"}})]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"name",label:"旷工次数",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-input-number",{attrs:{disabled:t.noModify},model:{value:e.row.score.data[2][10003].number,callback:function(n){t.$set(e.row.score.data[2][10003],"number",n)},expression:"scope.row.score.data['2']['10003']['number']"}})]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"分数",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t._f("getAttendanceScore")(e.row.score.data[2],t.ruleList))+"\n          ")]}}])})],1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[t.noModify?[n("el-button",{attrs:{size:"medium"},on:{click:function(e){t.showModifyPanel=!1}}},[t._v("关 闭\n        ")])]:[n("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.modifyAttendance}},[t._v("保存\n        ")]),t._v(" "),n("el-button",{attrs:{size:"medium"},on:{click:function(e){t.showModifyPanel=!1}}},[t._v("取 消\n        ")])]],2)])],1)},staticRenderFns:[]};var u=n("Z0/y")(s,l,!1,function(t){n("NG3m")},"data-v-20f46546",null);e.default=u.exports},NG3m:function(t,e){}});
//# sourceMappingURL=30.9af8c08b942508a3c9eb.js.map