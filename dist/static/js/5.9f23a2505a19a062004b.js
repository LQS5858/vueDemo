webpackJsonp([5],{"4fes":function(t,e){},TuQl:function(t,e){},cqCo:function(t,e){},kHDT:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("doty"),a=s("Gn4G"),o={props:["stepActive","deptLogs"],data:function(){return{newDeptLogs:"",activeClass:"iconfont icon-yuan",deactivation:"iconfont icon-yuan1"}},components:{},computed:{staff:function(){return this.$store.state.basic.staff},department:function(){return this.$store.state.basic.department},user:function(){return this.$store.state.common.user}},watch:{deptLogs:function(t){this.newDeptLogs=t}},methods:{getDate:function(t){var e=this.$options.filters.date(t,"YYYY-MM-DD HH:mm:ss"),s=this.$options.filters.date(new Date,"YYYY-MM-DD"),i=e.split(" ");return s===i[0]?"今天 "+i[1]:e},getName:function(t){if(t===this.user.uid)return"我";var e=this.$options.filters.getValueById(t,this.staff,"uid");return e.workDuty+" "+e.name},getDesc:function(t){var e='<span class="name">'+this.getName(t.staffUUID)+"</span> ";switch(t.scoreStatus){case 2:e+="提交考核申请";break;case 3:e+="驳回了"+this.$options.filters.getValueById(t.deptId,this.department,"id","name")+"的绩效考核申请";break;case 4:e+="通过了"+this.$options.filters.getValueById(t.deptId,this.department,"id","name")+"的绩效考核申请"}return e},closeOperationLog:function(){this.$emit("closeOperationLog")}}},n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"log-wrap"},[s("div",{staticClass:"log-header"},[s("div",{staticClass:"log-header-title"},[t._v("操作日志")]),t._v(" "),s("div",{staticClass:"icon el-icon-close log-icon",on:{click:t.closeOperationLog}})]),t._v(" "),s("div",{staticClass:"log-main"},[s("div",{staticClass:"audit-log"},t._l(t.newDeptLogs,function(e,i){return s("div",{key:i,staticClass:"audit-log-list"},[s("div",{staticClass:"audit-log-time"},[t._v(t._s(t.getDate(e.createTime)))]),t._v(" "),s("div",{staticClass:"audit-log-content",domProps:{innerHTML:t._s(t.getDesc(e))}}),t._v(" "),e.remark&&3===e.scoreStatus?s("div",{staticClass:"audit-log-remark"},[s("div",{staticClass:"audit-log-remark-title"},[t._v("驳回原因")]),t._v(" "),s("div",{staticClass:"audit-log-remark-content"},[t._v(t._s(e.remark))])]):t._e()])}))])])},staticRenderFns:[]};var r=s("Z0/y")(o,n,!1,function(t){s("cqCo"),s("4fes")},"data-v-1b0b9472",null).exports,c={data:function(){return{dirctorRole:!1,isShowOperationLog:!1,deptLogs:[],distribution:{},performanceData:[],accessDialogVisible:!1,denyDialogVisible:!1,remark:"",staffData:[],columnTitle:[{title:"姓名",row:"name"},{title:"职位",row:"workDuty"},{title:"项目评分",row:"score3",format:function(t){return t.score[3]?t.score[3].total:"-"}},{title:"基本评分",row:"score1",format:function(t){return t.score[1]?t.score[1].total:"-"}},{title:"行政考勤",row:"score2",format:function(t){return t.score[2]?t.score[2].total:"-"}},{title:"简报",row:"score5",format:function(t){return t.score[5]?t.score[5].total:"-"}},{title:"团队贡献",row:"score4",format:function(t){return t.score[4]?t.score[4].total:"-"}},{title:"绩效得分",row:"score",format:function(t){return t.score.performanceScore||"-"}},{title:"绩效等级",row:"level",format:function(t){return t.score.performanceLevel||"-"}}]}},computed:{quarterId:function(){return this.$store.state.common.quarterId},user:function(){return this.$store.state.common.user},deptInfo:function(){var t=this.$route.params.id||this.user.deptId,e=this.$store.state.basic.department;return this.$options.filters.getValueById(+t,e,"id")},staff:function(){return this.$store.state.basic.staff},deptId:function(){return this.$route.params.id},ratingRules:function(){return this.$store.state.basic.ratingRules},stepActive:function(){var t=1;switch((this.deptLogs[0]||{}).scoreStatus){case 1:t=1;break;case 2:t=2;break;case 4:t=3}return t}},methods:{back:function(){this.$router.go(-1)},handleClick:function(t,e){},getData:function(){var t=this;this.$http({url:"score/audit/detail",data:{quarterId:this.quarterId,deptId:this.deptId}}).then(function(e){t.staffData=e.staff,t.deptLogs=e.log,t.distribution=e.distribution})},checkAudit:function(t){var e=this;this.$http({url:"score/audit/check",data:{quarterId:this.quarterId,deptId:this.deptId,scoreStatus:t,remark:3===t?this.remark:""}}).then(function(t){e.$message.success("审核成功"),e.getData(),e.accessDialogVisible=!1,e.denyDialogVisible=!1})},handleOpenOperation:function(){this.isShowOperationLog=!this.isShowOperationLog},closeLog:function(){this.isShowOperationLog=!1},assessCommit:function(){var t=this,e=[];if(this.staffData.map(function(t){var s=!1;for(var i in t.score[1]){var a=t.score[1][i];a&&0!==a&&(s=!0)}for(var o in t.score[3]){var n=t.score[3][o];n&&0!==n&&(s=!0)}s||e.push(t.name)}),e.length)return this.$message.warning("提交审核需要先完成员工【"+e.join(",")+" 】的考核评分与项目评分");this.$http({url:"score/audit/submit",method:"post",data:{quarterId:this.quarterId}}).then(function(e){t.getData(),t.$message.success("提交审核成功")})}},beforeMount:function(){1===this.$store.state.common.user.role?this.dirctorRole=!0:this.dirctorRole=!1},mounted:function(){},components:{crumbsCom:i.a,ratingsTable:a.a,auditLog:r}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container dir-review-detail"},[s("crumbsCom",{staticClass:"top-nav",on:{callback:t.getData}},[t.dirctorRole?s("i",{staticClass:"iconfont icon-back",attrs:{slot:"backIcon"},on:{click:t.back},slot:"backIcon"}):t._e(),t._v(" "),s("div",{staticClass:"operation-log",attrs:{slot:"operation-log-btn"},slot:"operation-log-btn"},[s("el-button",{attrs:{type:"text",icon:"el-icon-document"},on:{click:t.handleOpenOperation}},[t._v("操作日志\n      ")])],1)]),t._v(" "),s("div",{staticClass:"sub-container"},[s("div",{staticClass:"table-part-container"},[s("div",{staticClass:"department-member "},[s("div",{staticClass:"examination-step attendance-search-table"},[s("el-steps",{attrs:{active:t.stepActive,"align-center":""}},[s("el-step",{attrs:{title:"部门考核",icon:"iconfont icon-yuan"}}),t._v(" "),s("el-step",{attrs:{title:"领导审核",icon:"iconfont icon-yuan1"}}),t._v(" "),s("el-step",{attrs:{title:"完成审核",icon:"iconfont icon-yuan1"}})],1),t._v(" "),s("div",{staticClass:"dept-wrap"},[s("div",{staticClass:"dept-information "},[s("li",{staticClass:"dept-name"},[t._v("部门名称")]),t._v(" "),s("li",[t._v(t._s(t.deptInfo.name))])]),t._v(" "),s("div",{staticClass:"leader-information"},[s("li",{staticClass:"dept-name"},[t._v("部门领导")]),t._v(" "),s("li",[t._v(t._s(t._f("getValueById")(t.deptInfo.ownerUUID,t.staff,"uid","name")))])])])],1),t._v(" "),s("div",{staticClass:"assessment-title"},[s("div",{staticClass:"group-title"},[t._v("绩效等级名额")]),t._v(" "),s("div",[t._v("A (可评:"+t._s(t.distribution.ratA||0)+" ; 已评: 1）")]),t._v(" "),s("div",[t._v("B (可评:"+t._s(t.distribution.ratB||0)+" ; 已评: 1）")]),t._v(" "),s("div",[t._v("C (可评:"+t._s(t.distribution.ratC||0)+" ; 已评: 1）")]),t._v(" "),s("div",[t._v("D (可评:"+t._s(t.distribution.ratD||0)+" ; 已评: 1）")]),t._v(" "),s("div",[t._v("D (可评:"+t._s(t.distribution.ratE||0)+" ; 已评: 1）")]),t._v(" "),s("div",[t._v("D (可评:"+t._s(t.distribution.ratF||0)+" ; 已评: 1）")])]),t._v(" "),s("el-table",{staticStyle:{width:"100%"},attrs:{stripe:"",data:t.staffData}},[s("el-table-column",{attrs:{type:"index",width:"100",label:"序号"}}),t._v(" "),t._l(t.columnTitle,function(t,e){return s("el-table-column",{key:e,attrs:{width:t.width||"",prop:t.row,formatter:t.format,label:t.title}})}),t._v(" "),t.deptId||2!==t.user.role?t._e():s("el-table-column",{attrs:{prop:"operation",width:"100",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.deptLogs[0]&&1!==t.deptLogs[0].scoreStatus&&3!==t.deptLogs[0].scoreStatus?s("router-link",{attrs:{to:"/performance-detail/"+e.row.staffId}},[t._v("详情\n              ")]):s("router-link",{attrs:{to:"/score-page/"+e.row.staffId}},[t._v("编辑\n              ")])]}}])})],2),t._v(" "),s("div",{staticClass:"attendance-tab-title-wrap"},[t.deptId||2!==t.user.role?s("div",{directives:[{name:"show",rawName:"v-show",value:2===t.stepActive,expression:"stepActive === 2"}],staticClass:"btn-group attendance-btn"},[s("el-button",{staticClass:"btn",attrs:{type:"primary",size:"midum"},on:{click:function(e){t.accessDialogVisible=!0}}},[t._v("通过\n            ")]),t._v(" "),s("el-button",{staticClass:"btn",attrs:{size:"small"},on:{click:function(e){t.denyDialogVisible=!0}}},[t._v("驳回\n            ")])],1):s("div",{staticClass:"btn-group attendance-btn"},[s("el-button",{directives:[{name:"show",rawName:"v-show",value:1===t.stepActive,expression:"stepActive === 1"}],attrs:{type:"primary"},on:{click:t.assessCommit}},[t._v("提交考核\n            ")])],1)])],1)])]),t._v(" "),s("div",{staticClass:"pass"},[s("el-dialog",{attrs:{title:"通过",visible:t.accessDialogVisible,width:"30%"},on:{"update:visible":function(e){t.accessDialogVisible=e}}},[s("p",{staticClass:"dialog-msg"},[t._v('是否确认通过对"'+t._s(t.deptInfo.name)+'"的绩效考核?')]),t._v(" "),s("span",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"small"},on:{click:function(e){t.accessDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.checkAudit(4)}}},[t._v("确 定")])],1)])],1),t._v(" "),s("div",{staticClass:"no-pass"},[s("el-dialog",{attrs:{title:"驳回",visible:t.denyDialogVisible,width:"30%"},on:{"update:visible":function(e){t.denyDialogVisible=e}}},[s("p",{staticClass:"dialog-msg"},[t._v('是否确认驳回对"'+t._s(t.deptInfo.name)+'"的审核?')]),t._v(" "),s("p",{staticClass:"no-pass-why"},[t._v("驳回原因:")]),t._v(" "),s("el-input",{attrs:{type:"textarea"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}}),t._v(" "),s("span",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.checkAudit(3)}}},[t._v("确 定")]),t._v(" "),s("el-button",{attrs:{size:"small"},on:{click:function(e){t.denyDialogVisible=!1}}},[t._v("取 消")])],1)],1)],1),t._v(" "),s("transition",{attrs:{name:"el-fade-in-linear"}},[s("audit-log",{directives:[{name:"show",rawName:"v-show",value:t.isShowOperationLog,expression:"isShowOperationLog"}],attrs:{stepActive:t.stepActive,deptLogs:t.deptLogs},on:{closeOperationLog:t.closeLog}})],1)],1)},staticRenderFns:[]};var u=s("Z0/y")(c,l,!1,function(t){s("qjE1"),s("TuQl")},"data-v-449a9d64",null);e.default=u.exports},qjE1:function(t,e){}});
//# sourceMappingURL=5.9f23a2505a19a062004b.js.map